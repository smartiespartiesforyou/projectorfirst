<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pop the Balloon — Word Guess</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ✅ Memberstack Loader -->
  <script data-memberstack-app="app_cmgnwpg8y00x10suih4pua785"
          src="https://static.memberstack.com/scripts/v2/memberstack.js"
          type="text/javascript"></script>

  <!-- ✅ Protect this page -->
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        const member = await window.$memberstackDom.getCurrentMember();
        if (!member.data) {
          window.location.href = "/subscribe.html";
        }
      } catch {
        window.location.href = "/subscribe.html";
      }
    });
  </script>
</head>

<body class="bg-white text-gray-900 min-h-screen"></script>

  <div class="max-w-5xl mx-auto p-6">
    <h1 class="text-4xl font-bold text-blue-700 text-center mb-6">Pictionary — Reveal Mode</h1>

    <!-- Back to Apps -->
    <div class="mb-6 text-center">
      <a href="apps.html" class="px-6 py-3 bg-blue-600 hover:bg-blue-800 text-white text-xl rounded-2xl">⬅ Back to Apps</a>
    </div>

    <!-- Controls -->
    <div class="grid md:grid-cols-3 gap-4 items-end mb-6">
      <div>
        <label for="theme" class="block text-lg font-semibold text-blue-700 mb-2">Theme</label>
        <select id="theme"
                class="w-full text-xl p-3 border-2 border-blue-600 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-400">
          <option value="animals">Animals</option>
          <option value="foods">Foods</option>
          <option value="objects">Objects</option>
        </select>
      </div>
      <div>
        <label class="block text-lg font-semibold text-blue-700 mb-2">New Picture</label>
        <button id="newBtn"
                class="w-full bg-blue-600 hover:bg-blue-800 text-white text-xl py-3 px-6 rounded-2xl">
          New Picture
        </button>
      </div>
      <div class="flex md:justify-end gap-3">
        <button id="revealOne"
                class="flex-1 md:flex-none bg-green-600 hover:bg-green-800 text-white text-xl py-3 px-6 rounded-2xl">
          Reveal One
        </button>
        <button id="revealAll"
                class="flex-1 md:flex-none bg-amber-500 hover:bg-amber-600 text-white text-xl py-3 px-6 rounded-2xl">
          Reveal All
        </button>
      </div>
    </div>

    <!-- Reveal by number -->
    <div class="mt-3 mb-6 flex justify-center gap-3">
      <input id="tileNumberInput" type="number" min="1" max="16"
             class="w-32 text-center text-2xl border-2 border-blue-600 rounded-2xl px-3 py-2"
             placeholder="# (1–16)"/>
      <button id="revealSpecific"
              class="bg-blue-600 hover:bg-blue-800 text-white text-xl py-2 px-5 rounded-2xl">
        Reveal This #
      </button>
    </div>

    <!-- Board -->
    <div class="relative mx-auto aspect-square w-full max-w-3xl rounded-2xl border-4 border-blue-600 overflow-hidden bg-gray-100">
      <!-- Hidden picture -->
      <div id="picture" class="absolute inset-0 z-0 flex items-center justify-center select-none text-[60vmin] leading-none"></div>

      <!-- Tile grid -->
      <div id="tiles" class="absolute inset-0 z-10 grid grid-cols-4 grid-rows-4 gap-0"></div>
    </div>

    <!-- Status -->
    <div id="status" class="text-center mt-6 text-2xl font-semibold text-blue-700"></div>
  </div>

  <script>
    const BANK = {
      animals: [
        {emoji:"🦒", name:"GIRAFFE"},{emoji:"🦓", name:"ZEBRA"},{emoji:"🐘", name:"ELEPHANT"},
        {emoji:"🦊", name:"FOX"},{emoji:"🦉", name:"OWL"},{emoji:"🐼", name:"PANDA"},
        {emoji:"🦍", name:"GORILLA"},{emoji:"🦘", name:"KANGAROO"},{emoji:"🦏", name:"RHINOCEROS"},
        {emoji:"🦔", name:"HEDGEHOG"}
      ],
      foods: [
        {emoji:"🍍", name:"PINEAPPLE"},{emoji:"🥐", name:"CROISSANT"},{emoji:"🍉", name:"WATERMELON"},
        {emoji:"🍇", name:"GRAPES"},{emoji:"🧀", name:"CHEESE"},{emoji:"🍓", name:"STRAWBERRY"},
        {emoji:"🍔", name:"HAMBURGER"},{emoji:"🍣", name:"SUSHI"},{emoji:"🥨", name:"PRETZEL"},
        {emoji:"🍆", name:"EGGPLANT"}
      ],
      objects: [
        {emoji:"⛺", name:"TENT"},{emoji:"🚲", name:"BICYCLE"},{emoji:"🕰️", name:"CLOCK"},
        {emoji:"🎒", name:"BACKPACK"},{emoji:"🧯", name:"FIRE EXTINGUISHER"},{emoji:"🧲", name:"MAGNET"},
        {emoji:"🧳", name:"SUITCASE"},{emoji:"🔭", name:"TELESCOPE"},{emoji:"🧵", name:"THREAD"},
        {emoji:"🧱", name:"BRICK"}
      ]
    };

    let theme = "animals";
    let item = null;
    const GRID_SIZE = 4;                 
    const TOTAL = GRID_SIZE * GRID_SIZE; 

    const pick = arr => arr[Math.floor(Math.random() * arr.length)];

    function setStatus(msg, color="text-blue-700") {
      const el = document.getElementById("status");
      el.className = `text-center mt-6 text-2xl font-semibold ${color}`;
      el.textContent = msg;
    }

    function renderPicture() {
      document.getElementById("picture").textContent = item.emoji;
    }

    function renderTiles() {
      const wrap = document.getElementById("tiles");
      wrap.innerHTML = "";
      for (let i = 0; i < TOTAL; i++) {
        const btn = document.createElement("button");
        btn.className =
          "tile w-full h-full bg-blue-700 hover:bg-blue-800 text-white border border-blue-900 " +
          "flex items-center justify-center select-none font-extrabold text-7xl md:text-8xl";
        btn.textContent = i + 1;       
        btn.dataset.index = i;         
        wrap.appendChild(btn);
      }
      setStatus(`Tiles left: ${TOTAL} / ${TOTAL}`);
    }

    // Reveal on click
    document.getElementById("tiles").addEventListener("click", (e) => {
      const tile = e.target.closest(".tile");
      if (!tile) return;
      if (!tile.classList.contains("revealed")) tile.classList.add("revealed");
      updateStatus();
    });

    function updateStatus() {
      const left = document.querySelectorAll("#tiles .tile:not(.revealed)").length;
      if (left === 0) {
        setStatus(`🎉 All tiles revealed — Answer: ${item.name}`, "text-green-700");
      } else {
        setStatus(`Tiles left: ${left} / ${TOTAL}`);
      }
    }

    function revealOneRandom() {
      const tiles = Array.from(document.querySelectorAll("#tiles .tile:not(.revealed)"));
      if (!tiles.length) return;
      pick(tiles).classList.add("revealed");
      updateStatus();
    }

    function revealAll() {
      document.querySelectorAll("#tiles .tile").forEach(t => t.classList.add("revealed"));
      setStatus(`🎉 All tiles revealed — Answer: ${item.name}`, "text-green-700");
    }

    function newPicture() {
      item = pick(BANK[theme]);
      renderPicture();
      renderTiles();
    }

    // Reveal specific by input
    function revealSpecificTile() {
      const inputEl = document.getElementById("tileNumberInput");
      const numberToReveal = parseInt(inputEl.value, 10);

      if (isNaN(numberToReveal) || numberToReveal < 1 || numberToReveal > TOTAL) {
        setStatus(`Please enter a number between 1 and ${TOTAL}.`, "text-red-600");
        inputEl.focus();
        return;
      }

      const allTiles = Array.from(document.querySelectorAll("#tiles .tile"));
      const tile = allTiles.find(t => parseInt(t.textContent, 10) === numberToReveal);

      if (!tile) {
        setStatus(`Tile ${numberToReveal} is already revealed!`, "text-orange-600");
        return;
      }

      tile.classList.add("revealed");
      inputEl.value = "";
      updateStatus();
    }

    // UI hooks
    document.getElementById("theme").addEventListener("change", e => { theme = e.target.value; newPicture(); });
    document.getElementById("newBtn").addEventListener("click", newPicture);
    document.getElementById("revealOne").addEventListener("click", revealOneRandom);
    document.getElementById("revealAll").addEventListener("click", revealAll);
    document.getElementById("revealSpecific").addEventListener("click", revealSpecificTile);
    document.getElementById("tileNumberInput").addEventListener("keydown", (e) => {
      if (e.key === "Enter") revealSpecificTile();
    });

    // Init
    newPicture();
  </script>
</body>
</html>
