<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Resident Feud — ProjectorFirst</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { background:#0b2a8a; color:#fff; font-family: Arial, sans-serif; }
  .card { background:#ffffff; color:#0b2a8a; border:6px solid #1e3a8a; border-radius:20px; }
  .answer-card { cursor:pointer; user-select:none; }
  .answer-revealed { background:#e6ffe6 !important; border-color:#16a34a !important; }
  .overlayX {
    position: fixed; inset: 0; display:none; align-items:center; justify-content:center;
    background: rgba(220, 38, 38, 0.20); z-index: 50;
  }
  .overlayX .bigX {
    font-size: 22vw; line-height: 1; font-weight: 900; color:#ff0000;
    text-shadow: 0 0 40px rgba(0,0,0,0.6);
  }
  /* Drawer */
  #drawer {
    position: fixed; top:0; right:-520px; width:520px; height:100vh; z-index:60;
    background:#ffffff; color:#0b2a8a; border-left:8px solid #1e3a8a;
    box-shadow: -10px 0 30px rgba(0,0,0,0.25); transition:right .25s ease;
    overflow:auto;
  }
  #drawer.open { right:0; }
  .big-btn { font-size:32px; padding:18px 28px; font-weight:800; border-radius:16px; }
  .team-toggle.active { outline:6px solid #facc15; }
</style>
</head>
<body>

<!-- Top bar -->
<div class="flex flex-wrap items-center justify-between gap-4 p-6">
  <a href="apps.html" class="bg-blue-900 hover:bg-blue-800 px-6 py-3 rounded-xl text-white font-bold text-xl">← Apps</a>

  <!-- Team Selector -->
  <div class="flex items-center gap-3">
    <span class="text-xl font-bold">Award points to:</span>
    <button id="team1Btn" class="team-toggle bg-white text-blue-900 font-extrabold text-2xl rounded-xl px-5 py-3">Table 1</button>
    <button id="team2Btn" class="team-toggle bg-white text-blue-900 font-extrabold text-2xl rounded-xl px-5 py-3">Table 2</button>
    <span class="text-sm opacity-80">(Leave none selected to reveal with no points.)</span>
  </div>

  <div class="flex items-center gap-3">
    <button id="openEditor" class="bg-purple-700 hover:bg-purple-600 px-6 py-3 rounded-xl text-white font-bold text-xl">Question Editor</button>
    <button id="nextQ" class="bg-green-600 hover:bg-green-500 px-6 py-3 rounded-xl text-white font-bold text-xl">Next Question</button>
  </div>
</div>

<!-- Scores + Strike -->
<div class="max-w-6xl mx-auto px-6 mb-4">
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 items-center">
    <!-- Scores -->
    <div class="card p-5 text-center">
      <div class="text-3xl font-extrabold text-blue-900">Table 1</div>
      <div id="score1" class="text-6xl font-black text-blue-900 mt-2">0</div>
    </div>
    <div class="flex items-center justify-center">
      <button id="strikeBtn" class="big-btn bg-red-600 hover:bg-red-500 text-white">❌ Strike</button>
    </div>
    <div class="card p-5 text-center">
      <div class="text-3xl font-extrabold text-blue-900">Table 2</div>
      <div id="score2" class="text-6xl font-black text-blue-900 mt-2">0</div>
    </div>
  </div>
</div>

<!-- Question -->
<div class="max-w-6xl mx-auto px-6">
  <div id="questionBox" class="card p-8 text-center">
    <div class="text-3xl sm:text-5xl font-extrabold">Press “Next Question”</div>
  </div>
</div>

<!-- Answers grid -->
<div class="max-w-6xl mx-auto px-6 mt-6">
  <div id="answersGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-6"></div>
</div>

<!-- Big X overlay -->
<div id="overlayX" class="overlayX"><div class="bigX">X</div></div>

<!-- Drawer Editor -->
<div id="drawer">
  <div class="p-6">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-3xl font-extrabold">Question Editor</h2>
      <button id="closeEditor" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-xl font-bold text-blue-900">Close</button>
    </div>

    <label class="font-bold">Question</label>
    <textarea id="qInput" class="w-full border-2 border-blue-900 rounded-xl p-3 mb-4" rows="2" placeholder="e.g., Name something you bring to a picnic."></textarea>

    <div class="flex items-center justify-between mb-2">
      <div class="font-bold">Answers (click “+ Add Answer” to add rows)</div>
      <button id="addAns" class="bg-blue-900 text-white px-4 py-2 rounded-xl font-bold">+ Add Answer</button>
    </div>

    <div id="ansList" class="space-y-3 mb-6"></div>

    <button id="saveQ" class="bg-green-600 hover:bg-green-500 text-white font-bold px-6 py-3 rounded-xl">Save Question</button>

    <hr class="my-6 border-blue-200">

    <h3 class="text-2xl font-extrabold mb-2">Saved Questions</h3>
    <div id="savedWrap" class="space-y-2"></div>
  </div>
</div>

<script>
/* ------------------ Audio (WebAudio tones) ------------------ */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playTone(freq=880, dur=0.15, type='sine', vol=0.2) {
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type; o.frequency.value = freq;
  g.gain.value = vol;
  o.connect(g).connect(audioCtx.destination);
  o.start();
  setTimeout(()=>{ o.stop(); }, dur*1000);
}
function ding() { playTone(1200, 0.10, 'sine', 0.25); setTimeout(()=>playTone(1500,0.10,'sine',0.25), 110); }
function buzz() { playTone(200, 0.25, 'square', 0.3); setTimeout(()=>playTone(160, 0.25,'square',0.3), 260); }

/* ------------------ State ------------------ */
let questions = JSON.parse(localStorage.getItem('feudQuestions') || '[]');
let lastIndex = -1;

const defaultIfEmpty = [
  {
    q: "Name something you bring to a picnic.",
    answers: [
      { text: "Food", points: 35 },
      { text: "Blanket", points: 20 },
      { text: "Drinks", points: 18 },
      { text: "Utensils/Napkins", points: 12 },
      { text: "Games", points: 8 },
      { text: "Sunscreen", points: 7 }
    ]
  },
  {
    q: "Name something people do first thing in the morning.",
    answers: [
      { text: "Brush Teeth", points: 30 },
      { text: "Use Bathroom", points: 20 },
      { text: "Make Coffee", points: 18 },
      { text: "Shower", points: 12 },
      { text: "Check Phone", points: 10 },
      { text: "Get Dressed", points: 10 }
    ]
  }
];
if (questions.length === 0) { questions = defaultIfEmpty; localStorage.setItem('feudQuestions', JSON.stringify(questions)); }

/* ------------------ UI refs ------------------ */
const answersGrid = document.getElementById('answersGrid');
const questionBox = document.getElementById('questionBox');
const score1El = document.getElementById('score1');
const score2El = document.getElementById('score2');
const overlayX = document.getElementById('overlayX');

const team1Btn = document.getElementById('team1Btn');
const team2Btn = document.getElementById('team2Btn');

let activeTeam = null; // '1' or '2' or null
let score1 = 0, score2 = 0;

/* ------------------ Team toggle ------------------ */
function setActiveTeam(t) {
  activeTeam = t;
  team1Btn.classList.toggle('active', t === '1');
  team2Btn.classList.toggle('active', t === '2');
}
team1Btn.addEventListener('click', ()=> setActiveTeam(activeTeam === '1' ? null : '1'));
team2Btn.addEventListener('click', ()=> setActiveTeam(activeTeam === '2' ? null : '2'));

/* ------------------ Render Question ------------------ */
function pickRandomIndex() {
  if (questions.length === 1) return 0;
  let i;
  do { i = Math.floor(Math.random() * questions.length); } while (i === lastIndex);
  lastIndex = i;
  return i;
}

let current = null;

function renderQuestion(qObj) {
  current = JSON.parse(JSON.stringify(qObj)); // clone for safety
  // question
  questionBox.innerHTML = `<div class="text-3xl sm:text-5xl font-extrabold">${escapeHtml(current.q)}</div>`;

  // answers
  answersGrid.innerHTML = '';
  current.answers
    .filter(a => a.text && !isNaN(+a.points))
    .slice(0, 8) // up to 8 slots
    .forEach((a, idx) => {
      const card = document.createElement('button');
      card.className = 'card answer-card p-5 text-left';
      card.dataset.revealed = '0';
      card.dataset.points = String(+a.points);

      card.innerHTML = `
        <div class="flex items-center justify-between gap-4">
          <div class="text-2xl sm:text-3xl font-extrabold uppercase">#${idx+1}</div>
          <div class="text-2xl sm:text-3xl font-extrabold text-blue-900">[ HIDDEN ]</div>
        </div>
        <div class="mt-3 text-3xl sm:text-4xl font-black">${escapeHtml(a.text)}</div>
        <div class="mt-2 text-3xl sm:text-4xl font-black text-green-700 hidden">+ ${+a.points}</div>
      `;

      card.addEventListener('click', () => {
        if (card.dataset.revealed === '1') return;

        // reveal
        card.dataset.revealed = '1';
        card.classList.add('answer-revealed');
        const tags = card.querySelectorAll('div');
        // tags[0] is header row; tags[1] is text; tags[2] is points row
        tags[0].lastElementChild.textContent = '[ REVEALED ]';
        tags[2].classList.remove('hidden');

        // award points ONLY if a team is active
        const pts = +card.dataset.points;
        if (activeTeam === '1') { score1 += pts; score1El.textContent = String(score1); ding(); }
        else if (activeTeam === '2') { score2 += pts; score2El.textContent = String(score2); ding(); }
        else { // reveal with no points
          ding();
        }
      });

      answersGrid.appendChild(card);
    });
}

/* ------------------ Strike ------------------ */
document.getElementById('strikeBtn').addEventListener('click', () => {
  overlayX.style.display = 'flex';
  buzz();
  setTimeout(()=> overlayX.style.display = 'none', 2000);
});

/* ------------------ Next Question ------------------ */
document.getElementById('nextQ').addEventListener('click', () => {
  // auto-clear strikes overlay if visible
  overlayX.style.display = 'none';
  // render new question
  const idx = pickRandomIndex();
  renderQuestion(questions[idx]);
});

/* ------------------ Editor Drawer ------------------ */
const drawer = document.getElementById('drawer');
document.getElementById('openEditor').addEventListener('click', () => drawer.classList.add('open'));
document.getElementById('closeEditor').addEventListener('click', () => drawer.classList.remove('open'));

const ansList = document.getElementById('ansList');
document.getElementById('addAns').addEventListener('click', addAnswerRow);

function addAnswerRow(textVal = '', pointsVal = '') {
  const row = document.createElement('div');
  row.className = 'grid grid-cols-12 gap-3 items-center';
  row.innerHTML = `
    <div class="col-span-7">
      <input class="w-full border-2 border-blue-900 rounded-xl p-2" placeholder="Answer text" value="${escapeAttr(textVal)}">
    </div>
    <div class="col-span-3">
      <input class="w-full border-2 border-blue-900 rounded-xl p-2" type="number" min="0" placeholder="Points" value="${escapeAttr(pointsVal)}">
    </div>
    <div class="col-span-2">
      <button class="w-full bg-red-600 text-white px-3 py-2 rounded-xl">Delete</button>
    </div>
  `;
  const delBtn = row.querySelector('button');
  delBtn.addEventListener('click', () => row.remove());
  ansList.appendChild(row);
}

// seed two rows initially
addAnswerRow(); addAnswerRow();

document.getElementById('saveQ').addEventListener('click', () => {
  const q = (document.getElementById('qInput').value || '').trim();
  if (!q) { alert('Enter a question.'); return; }

  const rows = [...ansList.children];
  const answers = rows.map(r => {
    const [txtEl, ptsEl] = r.querySelectorAll('input');
    return { text: txtEl.value.trim(), points: Number(ptsEl.value) };
  }).filter(a => a.text && !isNaN(a.points));

  if (answers.length === 0) { alert('Add at least one answer with points.'); return; }

  questions.push({ q, answers });
  localStorage.setItem('feudQuestions', JSON.stringify(questions));

  document.getElementById('qInput').value = '';
  ansList.innerHTML = '';
  addAnswerRow(); addAnswerRow();
  rebuildSaved();
});

function rebuildSaved() {
  const wrap = document.getElementById('savedWrap');
  wrap.innerHTML = '';
  questions.forEach((item, i) => {
    const div = document.createElement('div');
    div.className = 'border-2 border-blue-200 rounded-xl p-3';
    const list = item.answers.map(a => `<li>${escapeHtml(a.text)} — <strong>${a.points}</strong></li>`).join('');
    div.innerHTML = `
      <div class="flex items-start justify-between gap-4">
        <div>
          <div class="font-extrabold mb-2">${escapeHtml(item.q)}</div>
          <ul class="list-disc list-inside text-sm">${list}</ul>
        </div>
        <button class="bg-red-600 text-white px-3 py-1 rounded-lg h-10">Delete</button>
      </div>
    `;
    const btn = div.querySelector('button');
    btn.addEventListener('click', () => {
      questions.splice(i,1);
      localStorage.setItem('feudQuestions', JSON.stringify(questions));
      rebuildSaved();
    });
    wrap.appendChild(div);
  });
}
rebuildSaved();

/* ------------------ Helpers ------------------ */
function escapeHtml(s){ return s.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
function escapeAttr(s){ return String(s).replace(/"/g, '&quot;'); }
</script>
</body>
</html>
