<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Resident Feud — ProjectorFirst</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  /* ProjectorFirst Theme Colors */
  :root {
    --pf-dark-blue: #0b2a8a;
    --pf-mid-blue: #1e3a8a;
    --pf-yellow: #facc15;
    --pf-green: #16a34a;
    --pf-red: #dc2626;
    --pf-white: #ffffff;
  }
  body { 
    background:var(--pf-dark-blue); 
    color:var(--pf-white); 
    font-family: Arial, sans-serif; 
    /* Ensure full screen for layout calculations */
    min-height: 100vh;
  }
  
  /* Card styling, replicating the blue/white border */
  .card { 
    background: linear-gradient(to top, #0066cc, #1e3a8a); /* Gradient blue */
    color:var(--pf-white); 
    border:6px solid var(--pf-white); /* White inner border */
    border-radius:12px; 
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
  }
  
  /* Answer Card and Placeholder Styling */
  .answer-card { 
    cursor: pointer; 
    user-select: none; 
    height: 100%; 
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 80px;
  }
  .answer-revealed { 
    background:#ecfdf5 !important; 
    border-color:var(--pf-green) !important; 
    color: var(--pf-dark-blue) !important;
  }
  .answer-text-wrap { display: none; padding: 1.5rem; width: 100%; }
  .answer-revealed .answer-text-wrap { display: flex; }
  .answer-revealed .answer-placeholder { display: none; }
  .answer-placeholder {
    font-size: 3rem; 
    font-weight: 900; 
    color: var(--pf-white); 
    padding: 0 1.5rem;
    background: transparent;
    border-radius: 12px;
  }
  /* Make number background a circle inside the card */
  .answer-card .number-circle {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    padding: 0.5rem 1rem;
    border: 4px solid var(--pf-white);
    display: inline-block;
    line-height: 1;
  }

  /* Score Boxes - large and contrasting */
  .score-box {
    font-size: 6rem; 
    line-height: 1;
    font-weight: 900; 
    color: var(--pf-white); 
    padding: 1.5rem;
    border-radius: 20px;
    box-shadow: 0 0 20px rgba(0,0,0,0.4);
    min-width: 120px; 
    min-height: 120px; 
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  /* Strikes Bar */
  #strikes-bar {
    background: #1e3a8a; /* Dark blue background */
    border: 5px solid #ffffff; /* White border */
    border-radius: 12px;
    padding: 10px 0;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    margin-top: 1rem;
  }
  .strike-mark { 
    font-size: 5rem; 
    line-height: 1;
    font-weight: 900; 
    color: var(--pf-red); 
    opacity: 0.1; 
    transition: opacity 0.3s;
    margin: 0 10px;
  }
  .strike-mark.active { opacity: 1; }
  .team-toggle.active { outline: 3px solid var(--pf-yellow); }
</style>
</head>

<body>

<div class="flex flex-wrap items-center justify-between gap-4 p-4 bg-gray-900/50" id="controls">
  <a href="#" class="bg-blue-900 hover:bg-blue-800 px-4 py-2 rounded-lg text-white font-bold text-lg">← Apps</a>

    <div class="flex items-center gap-3">
    <span class="text-xl font-bold">Award points to:</span>
    <button id="team1Btn" class="team-toggle bg-white text-blue-900 font-extrabold text-2xl rounded-lg px-4 py-2">Team A</button>
    <button id="team2Btn" class="team-toggle bg-white text-blue-900 font-extrabold text-2xl rounded-lg px-4 py-2">Team B</button>
  </div>

  <div class="flex items-center gap-3">
    <button id="openEditor" class="bg-purple-700 hover:bg-purple-600 px-4 py-2 rounded-lg text-white font-bold text-lg">Question Editor</button>
    <button id="nextQ" class="bg-green-600 hover:bg-green-500 px-4 py-2 rounded-lg text-white font-bold text-lg">Next Question</button>
  </div>
</div>

<div class="w-full max-w-7xl mx-auto px-6" style="height: calc(100vh - 80px);">
  <div class="grid grid-cols-5 gap-8 items-center h-full">
    
        <div class="col-span-1 flex flex-col items-center justify-center pt-10">
      <div class="text-3xl font-extrabold text-white mb-2">RESIDENTS TEAM A</div>
      <div id="score1" class="score-box bg-red-700 w-full text-center">0</div>
    </div>

        <div class="col-span-3 flex flex-col items-center justify-center h-full">
      
            <div id="answersGrid" class="grid grid-cols-2 gap-4 w-full max-w-xl flex-grow my-4">
                <div class="card answer-card h-full"><div class="answer-placeholder"><span class="number-circle">1</span></div></div>
        <div class="card answer-card h-full"><div class="answer-placeholder"><span class="number-circle">4</span></div></div>
        <div class="card answer-card h-full"><div class="answer-placeholder"><span class="number-circle">2</span></div></div>
        <div class="card answer-card h-full"><div class="answer-placeholder"><span class="number-circle">5</span></div></div>
        <div class="card answer-card h-full"><div class="answer-placeholder"><span class="number-circle">3</span></div></div>
        <div class="card answer-card h-full"><div class="answer-placeholder"><span class="number-circle">6</span></div></div>
      </div>

            <div id="strikes-bar">
        <div id="strike1" class="strike-mark">X</div>
        <div id="strike2" class="strike-mark">X</div>
        <div id="strike3" class="strike-mark">X</div>
      </div>
      
            <div id="questionBox" class="card p-6 text-center bg-yellow-400 !border-yellow-600 w-full max-w-xl mt-6 !text-blue-900">
        <div class="text-3xl sm:text-4xl font-extrabold">Press “Next Question” to start</div>
      </div>

            <button id="strikeBtn" class="bg-red-600 hover:bg-red-500 text-white font-bold text-xl px-6 py-2 rounded-lg mt-4">❌ WRONG ANSWER (Strike)</button>
    </div>

        <div class="col-span-1 flex flex-col items-center justify-center pt-10">
      <div class="text-3xl font-extrabold text-white mb-2">RESIDENTS TEAM B</div>
      <div id="score2" class="score-box bg-green-700 w-full text-center">0</div>
    </div>

  </div>
</div>

<div id="overlayX" class="fixed inset-0 hidden items-center justify-center bg-red-700/40 z-50">
  <div class="text-[30vw] leading-none font-black text-red-600 text-shadow-lg">X</div>
</div>

<div id="drawer" class="fixed top-0 right-[-520px] w-[520px] h-full z-50 bg-white text-blue-900 border-l-8 border-blue-900 shadow-2xl transition-all duration-300 overflow-auto">
  <div class="p-6">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-3xl font-extrabold">Question Editor</h2>
      <button id="closeEditor" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-xl font-bold text-blue-900">Close</button>
      <button id="deleteAll" class="bg-red-600 text-white px-4 py-2 rounded-xl font-bold">Delete All Qs</button>
    </div>

    <label class="font-bold">Question</label>
    <textarea id="qInput" class="w-full border-2 border-blue-900 rounded-xl p-3 mb-4" rows="2" placeholder="e.g., Name something you bring to a picnic."></textarea>

    <div class="flex items-center justify-between mb-2">
      <div class="font-bold">Answers (Max 6 for display)</div>
      <button id="addAns" class="bg-blue-900 text-white px-4 py-2 rounded-xl font-bold">+ Add Answer</button>
    </div>

    <div id="ansList" class="space-y-3 mb-6"></div>

    <button id="saveQ" class="bg-green-600 hover:bg-green-500 text-white font-bold px-6 py-3 rounded-xl">Save Question</button>

    <div id="refreshReminder" class="mt-4 p-3 bg-yellow-200 text-yellow-900 font-bold text-xl rounded-xl hidden">
      ✅ Questions Saved! Refresh the page to load new questions.
    </div>

    <hr class="my-6 border-blue-200">

    <h3 class="text-2xl font-extrabold mb-2">Saved Questions</h3>
    <div id="savedWrap" class="space-y-2"></div>
  </div>
</div>


<script>
/* ------------------ Audio (WebAudio tones) ------------------ */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playTone(freq=880, dur=0.15, type='sine', vol=0.2) {
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type; o.frequency.value = freq;
  g.gain.value = vol;
  o.connect(g).connect(audioCtx.destination);
  o.start();
  setTimeout(()=>{ o.stop(); }, dur*1000);
}
function ding() { playTone(1200, 0.10, 'sine', 0.25); setTimeout(()=>playTone(1500,0.10,'sine',0.25), 110); }
function buzz() { playTone(200, 0.25, 'square', 0.3); setTimeout(()=>playTone(160, 0.25,'square',0.3), 260); }
function fanfare() {
  ding();
  setTimeout(() => playTone(1800, 0.2, 'triangle', 0.3), 250);
  setTimeout(() => playTone(2200, 0.2, 'triangle', 0.3), 500);
}

/* ------------------ State ------------------ */
let questions = JSON.parse(localStorage.getItem('feudQuestions') || '[]');
let lastIndex = -1;
let current = null; // Current question object
let strikes = 0;

const defaultIfEmpty = [
  {
    q: "Name something a person does every morning.",
    answers: [
      { text: "Brush Teeth", points: 30 },
      { text: "Use Bathroom", points: 20 },
      { text: "Make Coffee/Tea", points: 18 },
      { text: "Shower", points: 12 },
      { text: "Check Phone", points: 10 },
      { text: "Get Dressed", points: 10 }
    ]
  },
  {
    q: "Name something you bring to a picnic.",
    answers: [
      { text: "Food", points: 35 },
      { text: "Blanket", points: 20 },
      { text: "Drinks", points: 18 },
      { text: "Utensils/Napkins", points: 12 },
      { text: "Games", points: 8 },
      { text: "Sunscreen", points: 7 }
    ]
  }
];
if (questions.length === 0) { questions = defaultIfEmpty; localStorage.setItem('feudQuestions', JSON.stringify(questions)); }

/* ------------------ UI refs ------------------ */
const answersGrid = document.getElementById('answersGrid');
const questionBox = document.getElementById('questionBox');
const score1El = document.getElementById('score1');
const score2El = document.getElementById('score2');
const overlayX = document.getElementById('overlayX');

const team1Btn = document.getElementById('team1Btn');
const team2Btn = document.getElementById('team2Btn');
const strikeMarks = [
  document.getElementById('strike1'),
  document.getElementById('strike2'),
  document.getElementById('strike3')
];


let activeTeam = null; // '1' or '2' or null
let totalScore1 = 0, totalScore2 = 0;

/* ------------------ Score & Strike Updates ------------------ */
function updateScores() {
  score1El.textContent = String(totalScore1);
  score2El.textContent = String(totalScore2);
}

function updateStrikes() {
  strikeMarks.forEach((el, i) => {
    el.classList.toggle('active', i < strikes);
  });
  if (strikes === 3) {
    questionBox.innerHTML = `<div class="text-3xl sm:text-4xl font-extrabold text-red-700">3 STRIKES! Choose a team to award the points.</div>`;
    fanfare();
  }
}

/* ------------------ Team toggle ------------------ */
function setActiveTeam(t) {
  activeTeam = t;
  team1Btn.classList.toggle('active', t === '1');
  team2Btn.classList.toggle('active', t === '2');
}
team1Btn.addEventListener('click', ()=> setActiveTeam(activeTeam === '1' ? null : '1'));
team2Btn.addEventListener('click', ()=> setActiveTeam(activeTeam === '2' ? null : '2'));

/* ------------------ Render Question ------------------ */
function pickRandomIndex() {
  if (questions.length === 1) return 0;
  let i;
  do { i = Math.floor(Math.random() * questions.length); } while (i === lastIndex);
  lastIndex = i;
  return i;
}

function renderQuestion(qObj) {
  current = JSON.parse(JSON.stringify(qObj)); // clone for safety
  strikes = 0;
  updateStrikes();
  setActiveTeam(null);
  overlayX.style.display = 'none';

  // question
  questionBox.innerHTML = `<div class="text-3xl sm:text-4xl font-extrabold text-blue-900">${escapeHtml(current.q)}</div>`;

  // answers
  answersGrid.innerHTML = '';
  current.answers
    .filter(a => a.text && !isNaN(+a.points))
    .sort((a, b) => b.points - a.points) // Sort answers by points (highest first)
    .slice(0, 6) // STRICTLY LIMIT TO 6 SLOTS
    .forEach((a, idx) => {
      const card = document.createElement('button');
      card.className = 'card answer-card'; 
      card.dataset.revealed = '0';
      card.dataset.points = String(+a.points);

      card.innerHTML = `
                <div class="answer-text-wrap items-center justify-between gap-4">
          <div class="text-2xl sm:text-3xl font-extrabold uppercase">${escapeHtml(a.text)}</div>
          <div class="text-2xl sm:text-3xl font-black text-green-700 text-right w-1/4">+ ${+a.points}</div>
        </div>
                <div class="answer-placeholder">
          <span class="number-circle">${idx + 1}</span>
        </div>
      `;

      card.addEventListener('click', () => {
        if (card.dataset.revealed === '1') return;

        // reveal
        card.dataset.revealed = '1';
        card.classList.add('answer-revealed');
        
        const pts = +card.dataset.points;
        
        // Award points ONLY if a team is active
        if (activeTeam === '1') { 
          totalScore1 += pts; 
        } else if (activeTeam === '2') { 
          totalScore2 += pts; 
        } 
        
        updateScores();
        ding();
      });

      answersGrid.appendChild(card);
    });
}

/* ------------------ Strike ------------------ */
document.getElementById('strikeBtn').addEventListener('click', () => {
  if (strikes < 3) {
    strikes++;
    updateStrikes();
    overlayX.style.display = 'flex';
    buzz();
    setTimeout(()=> overlayX.style.display = 'none', 1500); 
  } else {
    alert("Maximum strikes reached for this round!");
  }
});

/* ------------------ Next Question ------------------ */
document.getElementById('nextQ').addEventListener('click', () => {
  const idx = pickRandomIndex();
  renderQuestion(questions[idx]);
});

/* ------------------ Editor Drawer (Logic remains the same) ------------------ */
const drawer = document.getElementById('drawer');
document.getElementById('openEditor').addEventListener('click', () => {
  drawer.classList.add('open');
  rebuildSaved(); 
});
document.getElementById('closeEditor').addEventListener('click', () => drawer.classList.remove('open'));

const ansList = document.getElementById('ansList');
document.getElementById('addAns').addEventListener('click', addAnswerRow);

function addAnswerRow(textVal = '', pointsVal = '') {
  const row = document.createElement('div');
  row.className = 'grid grid-cols-12 gap-3 items-center';
  row.innerHTML = `
    <div class="col-span-7">
      <input class="w-full border-2 border-blue-900 rounded-xl p-2" placeholder="Answer text" value="${escapeAttr(textVal)}">
    </div>
    <div class="col-span-3">
      <input class="w-full border-2 border-blue-900 rounded-xl p-2" type="number" min="0" placeholder="Points" value="${escapeAttr(pointsVal)}">
    </div>
    <div class="col-span-2">
      <button class="w-full bg-red-600 text-white px-3 py-2 rounded-xl">Delete</button>
    </div>
  `;
  const delBtn = row.querySelector('button');
  delBtn.addEventListener('click', () => row.remove());
  ansList.appendChild(row);
}

// seed two rows initially
addAnswerRow(); addAnswerRow();

document.getElementById('saveQ').addEventListener('click', () => {
  const q = (document.getElementById('qInput').value || '').trim();
  if (!q) { alert('Enter a question.'); return; }

  const rows = [...ansList.children];
  const answers = rows.map(r => {
    const [txtEl, ptsEl] = r.querySelectorAll('input');
    return { text: txtEl.value.trim(), points: Number(ptsEl.value) };
  }).filter(a => a.text && !isNaN(a.points) && a.points >= 0); 

  if (answers.length === 0) { alert('Add at least one answer with points.'); return; }

  questions.push({ q, answers });
  localStorage.setItem('feudQuestions', JSON.stringify(questions));

  document.getElementById('qInput').value = '';
  ansList.innerHTML = '';
  addAnswerRow(); addAnswerRow();
  rebuildSaved();

  const notice = document.getElementById('refreshReminder');
  if (notice) notice.classList.remove('hidden');
});

document.getElementById('deleteAll').addEventListener('click', () => {
  if (confirm('Are you sure you want to delete ALL saved questions? This cannot be undone.')) {
    localStorage.removeItem('feudQuestions');
    questions = defaultIfEmpty;
    localStorage.setItem('feudQuestions', JSON.stringify(questions));
    rebuildSaved();
    alert("All questions deleted. Default questions have been reloaded. Please refresh the page to see changes.");
  }
});

function rebuildSaved() {
  const wrap = document.getElementById('savedWrap');
  wrap.innerHTML = '';
  questions.forEach((item, i) => {
    const div = document.createElement('div');
    div.className = 'border-2 border-blue-200 rounded-xl p-3';
    const sortedAnswers = item.answers.sort((a, b) => b.points - a.points);
    const list = sortedAnswers.map(a => `<li>${escapeHtml(a.text)} — <strong>${a.points}</strong></li>`).join('');

    div.innerHTML = `
      <div class="flex items-start justify-between gap-4">
        <div>
          <div class="font-extrabold mb-2">${escapeHtml(item.q)}</div>
          <ul class="list-disc list-inside text-sm">${list}</ul>
        </div>
        <button class="bg-red-600 text-white px-3 py-1 rounded-lg h-10">Delete</button>
      </div>
    `;
    const btn = div.querySelector('button');
    btn.addEventListener('click', () => {
      questions.splice(i,1);
      localStorage.setItem('feudQuestions', JSON.stringify(questions));
      rebuildSaved();
    });
    wrap.appendChild(div);
  });
}
rebuildSaved();

/* ------------------ Helpers ------------------ */
function escapeHtml(s){ return s.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
function escapeAttr(s){ return String(s).replace(/"/g, '&quot;'); }

// Initial render
updateScores();
</script>
</body>
</html>
