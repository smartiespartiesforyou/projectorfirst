<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Activity Calendar Maker — ProjectorFirst</title>

  <!-- Tailwind for clean layout -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Export libs -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    :root {
      --sheet-padding: 0.5in; /* matches print margin */
    }
    body { background:#fff; }
    .day-box { 
      min-height: 8.5rem; 
      background:#fff; 
      border:1px solid #d1d5db; 
      border-radius: .25rem; 
      padding:.25rem; 
      display:flex; 
      flex-direction:column;
    }
    .day-num {
      font-size:.75rem; 
      color:#6b7280; 
      text-align:right;
    }
    .notes {
      margin-top:.25rem;
      flex:1;
      border-radius:.25rem;
      padding:.25rem;
      outline:none;
      white-space:pre-wrap;
      line-height:1.15;
      font-size:0.95rem;
    }
    .notes:empty:before {
      content:"Type times + activities…";
      color:#9ca3af;
    }

    /* PRINT: force 11x17 landscape, hide controls, keep fat readable text */
    @media print {
      @page {
        size: 11in 17in landscape;
        margin: 0.5in;
      }
      #toolbar { display:none !important; }
      body { background:#fff !important; }
      #calendarSheet {
        box-shadow:none !important;
      }
    }

    /* Desktop sheet framing (nice on screen, irrelevant on print/PDF) */
    #calendarSheet {
      background:#fff;
      padding: var(--sheet-padding);
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
    }
  </style>
</head>
<body class="p-4">
  <!-- ===== Toolbar (hidden in print/PDF) ===== -->
  <section id="toolbar" class="max-w-screen-2xl mx-auto mb-4">
    <div class="flex flex-wrap items-end gap-3 bg-gray-50 border border-gray-200 p-3 rounded-xl">
      <div>
        <label class="block text-xs font-semibold text-gray-600">Facility Name</label>
        <input id="facility" class="border rounded-md px-3 py-2 text-sm" placeholder="Facility name (optional)"/>
      </div>
      <div>
        <label class="block text-xs font-semibold text-gray-600">Month</label>
        <select id="month" class="border rounded-md px-3 py-2 text-sm">
          <option value="0">January</option><option value="1">February</option><option value="2">March</option>
          <option value="3">April</option><option value="4">May</option><option value="5">June</option>
          <option value="6">July</option><option value="7">August</option><option value="8">September</option>
          <option value="9">October</option><option value="10">November</option><option value="11">December</option>
        </select>
      </div>
      <div>
        <label class="block text-xs font-semibold text-gray-600">Year</label>
        <input id="year" type="number" class="border rounded-md px-3 py-2 text-sm w-28" value="2025"/>
      </div>
      <button id="generateBtn" class="px-4 py-2 rounded-lg bg-blue-700 text-white font-semibold hover:bg-blue-800">
        Generate Month
      </button>
      <button id="clearBtn" class="px-4 py-2 rounded-lg bg-gray-700 text-white font-semibold hover:bg-gray-800">
        Clear Calendar
      </button>
      <button id="exportBtn" class="px-4 py-2 rounded-lg bg-emerald-700 text-white font-semibold hover:bg-emerald-800">
        Save as PDF (11×17)
      </button>
    </div>
  </section>

  <!-- ===== Sheet (this is what becomes the PDF) ===== -->
  <main id="calendarSheet" class="max-w-screen-2xl mx-auto">
    <!-- Header -->
    <header class="mb-3">
      <h1 id="titleLine" class="text-3xl font-extrabold text-center">Activity Calendar</h1>
      <p id="subtitleLine" class="text-center text-base text-gray-600 mt-1"></p>
    </header>

    <!-- Weekday headers -->
    <div class="grid grid-cols-7 gap-1 mb-1">
      <div class="bg-blue-900 text-white font-bold p-2 text-center">Sunday</div>
      <div class="bg-blue-900 text-white font-bold p-2 text-center">Monday</div>
      <div class="bg-blue-900 text-white font-bold p-2 text-center">Tuesday</div>
      <div class="bg-blue-900 text-white font-bold p-2 text-center">Wednesday</div>
      <div class="bg-blue-900 text-white font-bold p-2 text-center">Thursday</div>
      <div class="bg-blue-900 text-white font-bold p-2 text-center">Friday</div>
      <div class="bg-blue-900 text-white font-bold p-2 text-center">Saturday</div>
    </div>

    <!-- Calendar grid (filled by JS) -->
    <section id="calendarGrid" class="grid grid-cols-7 gap-1 border border-gray-300"></section>

    <!-- Footer line: revision date for compliance -->
    <footer class="mt-2 text-xs text-gray-500 text-right">
      <span id="revisionNote"></span>
    </footer>
  </main>

  <script>
    // ===== Utilities
    const monthNames = [
      "January","February","March","April","May","June",
      "July","August","September","October","November","December"
    ];

    function daysInMonth(monthIndex, year) {
      return new Date(year, monthIndex + 1, 0).getDate();
    }

    function firstWeekday(monthIndex, year) {
      // 0=Sun..6=Sat
      return new Date(year, monthIndex, 1).getDay();
    }

    // ===== DOM
    const facilityEl = document.getElementById("facility");
    const monthEl = document.getElementById("month");
    const yearEl = document.getElementById("year");
    const titleLine = document.getElementById("titleLine");
    const subtitleLine = document.getElementById("subtitleLine");
    const calendarGrid = document.getElementById("calendarGrid");
    const revisionNote = document.getElementById("revisionNote");

    const generateBtn = document.getElementById("generateBtn");
    const clearBtn = document.getElementById("clearBtn");
    const exportBtn = document.getElementById("exportBtn");

    // ===== Build calendar cells
    function buildCalendar(monthIndex, year) {
      calendarGrid.innerHTML = "";
      const startPad = firstWeekday(monthIndex, year);
      const totalDays = daysInMonth(monthIndex, year);
      const totalCells = Math.ceil((startPad + totalDays) / 7) * 7; // 5 or 6 weeks clean grid

      for (let i = 0; i < totalCells; i++) {
        const cell = document.createElement("div");
        cell.className = "day-box";

        const numWrap = document.createElement("div");
        numWrap.className = "day-num";

        const notes = document.createElement("div");
        notes.className = "notes";
        notes.contentEditable = "true";
        notes.setAttribute("aria-label", "Day activities");

        // Fill date or leave blank
        const dayNum = i - startPad + 1;
        if (dayNum > 0 && dayNum <= totalDays) {
          numWrap.textContent = dayNum;
        } else {
          numWrap.textContent = ""; // out-of-month
          notes.classList.add("opacity-50");
        }

        cell.appendChild(numWrap);
        cell.appendChild(notes);
        calendarGrid.appendChild(cell);
      }

      // Header text
      const fac = (facilityEl.value || "").trim();
      titleLine.textContent = fac ? `${fac} — Activity Calendar` : "Activity Calendar";
      subtitleLine.textContent = `${monthNames[monthIndex]} ${year}`;
      revisionNote.textContent = `Generated ${new Date().toLocaleString()} — Rev`;
    }

    // ===== Clear only the typed notes (keep dates and header)
    function clearCalendarNotes() {
      document.querySelectorAll(".notes").forEach(n => n.innerHTML = "");
    }

    // ===== Export as 11×17 PDF
    async function exportPDF() {
      // Capture only the sheet content
      const sheet = document.getElementById("calendarSheet");

      // Boost scale for crisp text in PDF
      const canvas = await html2canvas(sheet, {
        scale: 2,    // increase if you want sharper PDF, at cost of size/time
        useCORS: true,
        backgroundColor: "#ffffff"
      });

      const imgData = canvas.toDataURL("image/png");

      // jsPDF in inches; 17×11 landscape (tabloid)
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: "landscape", unit: "in", format: [17, 11] });

      // Fit image to page with margins equal to print @page (0.5in)
      const pageW = 17, pageH = 11;
      const margin = 0.5;
      const usableW = pageW - margin * 2;
      const usableH = pageH - margin * 2;

      // Compute image aspect fit
      const imgW = canvas.width;
      const imgH = canvas.height;
      const imgAspect = imgW / imgH;
      const pageAspect = usableW / usableH;

      let drawW, drawH;
      if (imgAspect > pageAspect) {
        drawW = usableW;
        drawH = usableW / imgAspect;
      } else {
        drawH = usableH;
        drawW = usableH * imgAspect;
      }

      const offsetX = (pageW - drawW) / 2;
      const offsetY = (pageH - drawH) / 2;

      pdf.addImage(imgData, "PNG", offsetX, offsetY, drawW, drawH, "", "FAST");

      const fac = (facilityEl.value || "").trim();
      const fileMonth = monthNames[parseInt(monthEl.value, 10)];
      const fileYear = parseInt(yearEl.value, 10);
      const fname = `${fac ? fac + " - " : ""}${fileMonth} ${fileYear} Activity Calendar.pdf`.replace(/\s+/g, " ").trim();

      pdf.save(fname);
    }

    // ===== Wire up controls
    generateBtn.addEventListener("click", () => {
      const m = parseInt(monthEl.value, 10);
      const y = parseInt(yearEl.value, 10);
      if (Number.isNaN(m) || Number.isNaN(y) || y < 1900) {
        alert("Enter a valid month and year.");
        return;
      }
      buildCalendar(m, y);
    });

    clearBtn.addEventListener("click", clearCalendarNotes);
    exportBtn.addEventListener("click", exportPDF);

    // ===== Defaults: load current month
    (function init() {
      const now = new Date();
      monthEl.value = now.getMonth().toString();
      yearEl.value = now.getFullYear().toString();
      buildCalendar(now.getMonth(), now.getFullYear());
    })();
  </script>
</body>
</html>
