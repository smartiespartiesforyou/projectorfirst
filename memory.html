<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Memory Match â€” ProjectorFirst</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Memberstack -->
  <script data-memberstack-app="app_cmgnwpg8y00x10suih4pua785"
          src="https://static.memberstack.com/scripts/v2/memberstack.js"
          type="text/javascript"></script>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        const member = await window.$memberstackDom.getCurrentMember();
        if (!member.data) window.location.href = "/subscribe.html";
      } catch {
        window.location.href = "/subscribe.html";
      }
    });
  </script>
</head>

<body class="bg-white text-gray-900 min-h-screen">

  <div class="w-full px-2 sm:px-6 lg:px-12 py-6">
    
    <!-- Title -->
    <h1 class="text-6xl font-extrabold mb-6 text-blue-900 text-center">
      Memory Match
    </h1>

    <!-- Controls -->
    <div class="flex justify-center gap-4 mb-6 flex-wrap">
      <a href="apps.html"
         class="px-8 py-4 bg-blue-900 text-white rounded-2xl text-2xl font-bold hover:bg-blue-800">
        â† Back
      </a>

      <button id="fullscreenBtn"
         class="px-8 py-4 bg-blue-700 text-white rounded-2xl text-2xl font-bold hover:bg-blue-800">
        â›¶ Full Screen
      </button>

      <button id="resetBtn"
         class="px-8 py-4 bg-blue-600 text-white rounded-2xl text-2xl font-bold hover:bg-blue-800">
        New Game
      </button>

      <select id="themeSelect"
        class="border-4 border-blue-700 rounded-xl px-4 py-3 text-2xl font-bold text-blue-900 bg-white">
        <option value="animals">ğŸ¶ Animals</option>
        <option value="food">ğŸ” Food</option>
        <option value="sports">âš½ Sports</option>
        <option value="christmas">ğŸ„ Christmas</option>
        <option value="halloween">ğŸƒ Halloween</option>
        <option value="easter">ğŸ£ Easter</option>
      </select>
    </div>

    <!-- âœ… GIANT FULL-WIDTH PROJECTOR GRID -->
    <div id="grid"
         class="w-full max-w-7xl mx-auto grid grid-cols-4 gap-3 justify-center">
    </div>

    <!-- Status -->
    <div id="status" class="text-center mt-6 text-3xl font-bold text-blue-700"></div>
  </div>

  <script>
    const fullscreenBtn = document.getElementById("fullscreenBtn");
    fullscreenBtn.addEventListener("click", () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
        fullscreenBtn.textContent = "Exit Full Screen";
      } else {
        document.exitFullscreen();
        fullscreenBtn.textContent = "â›¶ Full Screen";
      }
    });

    const totalPairs = 8;

    const themes = {
      animals: ["ğŸ¶","ğŸ±","ğŸ¦","ğŸ¸","ğŸ¢","ğŸ°","ğŸ¼","ğŸ§","ğŸ¦Š","ğŸ»","ğŸ¨","ğŸ·"],
      food: ["ğŸ”","ğŸ•","ğŸŸ","ğŸŒ­","ğŸ©","ğŸª","ğŸ¦","ğŸ","ğŸŒ","ğŸ‡","ğŸ“"],
      sports: ["âš½","ğŸ€","ğŸˆ","âš¾","ğŸ¾","ğŸ","ğŸ¥","ğŸ’"],
      christmas: ["ğŸ„","ğŸ…","ğŸ¤¶","ğŸ¦Œ","ğŸ","â›„","â„ï¸","ğŸ””"],
      halloween: ["ğŸƒ","ğŸ‘»","ğŸ•·ï¸","ğŸ•¸ï¸","ğŸ§›","ğŸ¦‡","ğŸ¬","â˜ ï¸"],
      easter: ["ğŸ£","ğŸ°","ğŸ¥š","ğŸŒ¸","ğŸ«","ğŸŒ¼","ğŸ¥","ğŸ§º"]
    };

    let currentTheme = "animals";
    let firstCard = null;
    let secondCard = null;
    let busy = false;
    let matchesFound = 0;
    let deck = [];

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function buildDeck() {
      const pool = shuffle([...themes[currentTheme]]);
      const picks = pool.slice(0, totalPairs);
      return shuffle([...picks, ...picks]).map((val, i) => ({
        id: i + 1,
        value: val,
        matched: false
      }));
    }

    function renderGrid() {
      const grid = document.getElementById("grid");
      grid.innerHTML = "";

      deck.forEach((card, idx) => {
        const btn = document.createElement("button");
        btn.dataset.index = idx;

        btn.className = [
          "relative",
          "w-[220px] h-[220px]",
          "rounded-2xl border-[8px] border-blue-700",
          "bg-white shadow-md",
          "flex items-center justify-center"
        ].join(" ");

        const back = document.createElement("div");
        back.className = "back absolute inset-0 flex items-center justify-center";
        back.innerHTML =
          `<span class="text-[7rem] font-extrabold text-blue-700">${card.id}</span>`;

        const front = document.createElement("div");
        front.className = "front absolute inset-0 hidden items-center justify-center";
        front.innerHTML =
          `<span class="text-[8rem]">${card.value}</span>`;

        btn.appendChild(back);
        btn.appendChild(front);
        btn.addEventListener("click", () => handleFlip(btn));
        grid.appendChild(btn);
      });
    }

    function showFront(btn, show) {
      btn.querySelector(".front").classList.toggle("hidden", !show);
      btn.querySelector(".back").classList.toggle("hidden", show);
    }

    function handleFlip(btn) {
      if (busy) return;
      const i = parseInt(btn.dataset.index, 10);
      const card = deck[i];
      if (card.matched) return;

      const frontVisible = !btn.querySelector(".front").classList.contains("hidden");
      if (frontVisible) return;

      showFront(btn, true);

      if (!firstCard) {
        firstCard = { btn, i, card };
      } else if (!secondCard && btn !== firstCard.btn) {
        secondCard = { btn, i, card };
        busy = true;
        checkMatch();
      }
    }

    function checkMatch() {
      const status = document.getElementById("status");
      const isMatch = firstCard.card.value === secondCard.card.value;

      if (isMatch) {
        deck[firstCard.i].matched = true;
        deck[secondCard.i].matched = true;

        firstCard.btn.classList.add("border-green-600");
        secondCard.btn.classList.add("border-green-600");

        matchesFound++;
        status.textContent = `Matched: ${matchesFound}/${totalPairs}`;

        resetTurn();

        if (matchesFound === totalPairs) {
          status.textContent = "ğŸ‰ Finished!";
        }
      } else {
        status.textContent = "Not a matchâ€¦";

        setTimeout(() => {
          showFront(firstCard.btn, false);
          showFront(secondCard.btn, false);
          resetTurn();
        }, 900);
      }
    }

    function resetTurn() {
      firstCard = null;
      secondCard = null;
      busy = false;
    }

    function newGame() {
      matchesFound = 0;
      deck = buildDeck();
      renderGrid();
      document.getElementById("status").textContent = "Pick two cards!";
    }

    document.getElementById("resetBtn").addEventListener("click", newGame);
    document.getElementById("themeSelect").addEventListener("change", e => {
      currentTheme = e.target.value;
      newGame();
    });

    newGame();
  </script>

</body>
</html>
