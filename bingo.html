<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bingo App — ProjectorFirst</title>
  <meta name="description" content="ProjectorFirst Bingo App: Big-font, projector-friendly Bingo caller for nursing homes and senior care." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="icon" href="/logo.svg" type="image/svg+xml" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">
  <a href="#main" class="absolute left-2 top-2 bg-green-400 text-gray-900 px-3 py-2 rounded focus:outline-none focus:ring-4 focus:ring-green-300">
    Skip to content
  </a>

  <header class="bg-gray-800 py-4 shadow-md">
    <div class="max-w-5xl mx-auto px-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-green-400">ProjectorFirst</h1>
      <nav class="space-x-2">
        <a href="/" class="px-3 py-2 rounded hover:bg-green-400 hover:text-gray-900 focus:outline-none focus:ring-4 focus:ring-green-300 transition">Home</a>
        <a href="/about.html" class="px-3 py-2 rounded hover:bg-green-400 hover:text-gray-900 focus:outline-none focus:ring-4 focus:ring-green-300 transition">About</a>
        <a href="/contact.html" class="px-3 py-2 rounded hover:bg-green-400 hover:text-gray-900 focus:outline-none focus:ring-4 focus:ring-green-300 transition">Contact</a>
        <a href="/apps.html" class="px-3 py-2 rounded hover:bg-green-400 hover:text-gray-900 focus:outline-none focus:ring-4 focus:ring-green-300 transition">Apps</a>
      </nav>
    </div>
  </header>

  <main id="main" class="max-w-6xl mx-auto p-6 md:p-10">
    <h2 class="text-3xl md:text-4xl font-extrabold text-center mb-6">Bingo App</h2>

    <!-- Status row -->
    <section class="flex flex-wrap items-center justify-center gap-4 mb-6">
      <div class="bg-gray-800 rounded-2xl px-5 py-3 text-lg md:text-2xl font-semibold">
        Called: <span id="calledCount" class="text-green-400">0</span>/75
      </div>
      <div class="bg-gray-800 rounded-2xl px-5 py-3 text-lg md:text-2xl font-semibold">
        Remaining: <span id="remainingCount" class="text-yellow-300">75</span>
      </div>
    </section>

    <!-- Big display -->
    <section aria-live="polite" aria-atomic="true" class="mb-6">
      <div id="currentCall"
           class="select-none text-center bg-black border-4 border-green-400 rounded-3xl shadow-xl mx-auto
                  flex items-center justify-center"
           style="height: 38vh;">
        <div class="leading-none">
          <div id="currentLetter" class="text-7xl md:text-8xl font-extrabold text-green-400">—</div>
          <div id="currentNumber" class="text-[10rem] md:text-[14rem] font-extrabold text-white tracking-tight">—</div>
        </div>
      </div>
      <p class="sr-only" id="srAnnouncement"></p>
    </section>

    <!-- Controls -->
    <section class="flex flex-wrap items-center justify-center gap-4 mb-8">
      <button id="callBtn"
              class="bg-green-400 text-gray-900 text-2xl md:text-3xl font-bold px-6 md:px-8 py-4 md:py-5 rounded-2xl shadow hover:bg-green-300 focus:outline-none focus:ring-4 focus:ring-green-300">
        Call Next (Space)
      </button>
      <button id="undoBtn"
              class="bg-yellow-300 text-gray-900 text-xl md:text-2xl font-bold px-5 md:px-6 py-4 rounded-2xl shadow hover:bg-yellow-200 focus:outline-none focus:ring-4 focus:ring-yellow-200">
        Undo (Backspace)
      </button>
      <button id="resetBtn"
              class="bg-red-400 text-gray-900 text-xl md:text-2xl font-bold px-5 md:px-6 py-4 rounded-2xl shadow hover:bg-red-300 focus:outline-none focus:ring-4 focus:ring-red-300">
        Reset (R)
      </button>
      <button id="fullscreenBtn"
              class="bg-gray-700 text-white text-xl md:text-2xl font-semibold px-5 md:px-6 py-4 rounded-2xl shadow hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-500">
        Fullscreen (F)
      </button>
      <button id="toggleBoardBtn"
              class="bg-blue-400 text-gray-900 text-xl md:text-2xl font-bold px-5 md:px-6 py-4 rounded-2xl shadow hover:bg-blue-300 focus:outline-none focus:ring-4 focus:ring-blue-300">
        Show Board (B)
      </button>
    </section>

    <!-- Board -->
    <section id="boardSection" class="hidden">
      <h3 class="text-2xl md:text-3xl font-bold mb-4 text-center">Bingo Board</h3>

      <!-- Column headers -->
      <div class="grid grid-cols-5 gap-2 md:gap-3 mb-2">
        <div class="text-center bg-blue-500 text-gray-900 font-extrabold text-2xl md:text-3xl py-2 rounded-xl shadow">B</div>
        <div class="text-center bg-purple-500 text-gray-900 font-extrabold text-2xl md:text-3xl py-2 rounded-xl shadow">I</div>
        <div class="text-center bg-green-500 text-gray-900 font-extrabold text-2xl md:text-3xl py-2 rounded-xl shadow">N</div>
        <div class="text-center bg-yellow-400 text-gray-900 font-extrabold text-2xl md:text-3xl py-2 rounded-xl shadow">G</div>
        <div class="text-center bg-pink-500 text-gray-900 font-extrabold text-2xl md:text-3xl py-2 rounded-xl shadow">O</div>
      </div>

      <!-- Numbers grid: 5 columns x 15 rows -->
      <div id="boardGrid" class="grid grid-cols-5 gap-2 md:gap-3" aria-label="Bingo board 1 to 75">
        <!-- Populated by JS -->
      </div>

      <!-- Legend -->
      <p class="mt-4 text-center text-base md:text-lg text-gray-300">
        <span class="inline-block w-5 h-5 align-middle rounded-md bg-green-400 border-2 border-white mr-2"></span>
        = Called &nbsp;&nbsp;|&nbsp;&nbsp;
        <span class="inline-block w-5 h-5 align-middle rounded-md ring-4 ring-yellow-300 mr-2"></span>
        = Most recent call
      </p>
    </section>

    <!-- Help -->
    <section class="mt-8 text-center text-gray-300">
      <p class="text-lg md:text-xl">
        Keyboard: <span class="font-semibold text-white">Space</span> = Call Next,
        <span class="font-semibold text-white">Backspace</span> = Undo,
        <span class="font-semibold text-white">R</span> = Reset,
        <span class="font-semibold text-white">F</span> = Fullscreen,
        <span class="font-semibold text-white">B</span> = Show/Hide Board.
      </p>
    </section>

    <div class="sr-only" id="live" aria-live="polite"></div>
  </main>

  <footer class="bg-gray-800 py-4 mt-12 text-center text-gray-400 text-sm">
    © <span id="year"></span> ProjectorFirst. All rights reserved.
  </footer>

  <script>
    // Accessibility: respect reduced motion
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    // Utils
    const range = (start, end) => Array.from({ length: end - start + 1 }, (_, i) => start + i);
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    function letterFor(n) {
      if (n >= 1 && n <= 15) return 'B';
      if (n >= 16 && n <= 30) return 'I';
      if (n >= 31 && n <= 45) return 'N';
      if (n >= 46 && n <= 60) return 'G';
      return 'O';
    }

    // DOM refs
    const calledCount = document.getElementById('calledCount');
    const remainingCount = document.getElementById('remainingCount');
    const currentLetter = document.getElementById('currentLetter');
    const currentNumber = document.getElementById('currentNumber');
    const historyGrid = document.getElementById('history'); // may not exist yet; safe no-op
    const srAnnouncement = document.getElementById('srAnnouncement');

    const callBtn = document.getElementById('callBtn');
    const undoBtn = document.getElementById('undoBtn');
    const resetBtn = document.getElementById('resetBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const toggleBoardBtn = document.getElementById('toggleBoardBtn');
    const boardSection = document.getElementById('boardSection');
    const boardGrid = document.getElementById('boardGrid');

    // Game state
    let deck = [];
    let called = [];

    // Board state
    const cells = new Map(); // n -> element
    let lastHighlighted = null;

    function initGame() {
      deck = shuffle(range(1, 75));
      called = [];
      renderBoard();
      updateUI();
      setDisplay(null);
    }

    // Build the 5 bingo columns and cells
    function renderBoard() {
      boardGrid.innerHTML = '';
      cells.clear();

      const columns = [
        { start: 1,  end: 15, color: 'border-blue-300 text-blue-200' },
        { start: 16, end: 30, color: 'border-purple-300 text-purple-200' },
        { start: 31, end: 45, color: 'border-green-300 text-green-200' },
        { start: 46, end: 60, color: 'border-yellow-300 text-yellow-200' },
        { start: 61, end: 75, color: 'border-pink-300 text-pink-200' },
      ];

      for (const col of columns) {
        const colWrap = document.createElement('div');
        colWrap.className = 'grid grid-rows-15 gap-2 md:gap-3';
        for (let n = col.start; n <= col.end; n++) {
          const cell = document.createElement('div');
          cell.id = `cell-${n}`;
          cell.setAttribute('role', 'button');
          cell.setAttribute('aria-label', `${letterFor(n)} ${n}`);
          cell.className = [
            'w-full aspect-square rounded-xl flex items-center justify-center',
            'text-xl md:text-2xl font-extrabold select-none',
            'bg-gray-800 border-2', col.color
          ].join(' ');
          cell.textContent = n;
          cells.set(n, cell);
          colWrap.appendChild(cell);
        }
        boardGrid.appendChild(colWrap);
      }
      // Apply called highlights (useful on reset or hydration)
      refreshBoardHighlights();
    }

    function setDisplay(n) {
      if (n === null) {
        currentLetter.textContent = '—';
        currentNumber.textContent = '—';
        currentNumber.style.transform = 'scale(1)';
        return;
      }
      const letter = letterFor(n);
      currentLetter.textContent = letter;
      currentNumber.textContent = n;

      if (!prefersReduced) {
        currentNumber.style.transform = 'scale(1.05)';
        currentNumber.style.transition = 'transform 120ms ease-out';
        requestAnimationFrame(() => {
          setTimeout(() => (currentNumber.style.transform = 'scale(1)'), 120);
        });
      }

      srAnnouncement.textContent = `${letter} ${n}`;
    }

    function updateUI() {
      calledCount.textContent = called.length;
      remainingCount.textContent = 75 - called.length;

      // History tiles (if the history grid exists from previous step)
      if (historyGrid) {
        historyGrid.innerHTML = '';
        const tiles = [...called].reverse();
        for (const n of tiles) {
          const letter = letterFor(n);
          const tile = document.createElement('div');
          tile.className = 'w-12 h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 rounded-xl flex items-center justify-center text-xl md:text-2xl font-extrabold ' +
            'bg-gray-800 border-2 ' +
            (letter === 'B' ? 'border-blue-300 text-blue-200' :
             letter === 'I' ? 'border-purple-300 text-purple-200' :
             letter === 'N' ? 'border-green-300 text-green-200' :
             letter === 'G' ? 'border-yellow-300 text-yellow-200' :
                              'border-pink-300 text-pink-200');
          tile.setAttribute('aria-label', `${letter} ${n}`);
          tile.textContent = `${letter}${n}`;
          historyGrid.appendChild(tile);
        }
      }

      refreshBoardHighlights();
    }

    function refreshBoardHighlights() {
      // Clear previous "last" ring
      if (lastHighlighted && cells.has(lastHighlighted)) {
        const prev = cells.get(lastHighlighted);
        prev.classList.remove('ring-4', 'ring-yellow-300');
      }

      // Mark all called numbers
      for (let n = 1; n <= 75; n++) {
        const el = cells.get(n);
        if (!el) continue;
        if (called.includes(n)) {
          el.classList.add('bg-green-400', 'text-gray-900', 'border-white');
          el.classList.remove('bg-gray-800');
        } else {
          el.classList.remove('bg-green-400', 'text-gray-900', 'border-white');
          el.classList.add('bg-gray-800');
        }
      }

      // Highlight most recent call
      if (called.length > 0) {
        const last = called[called.length - 1];
        lastHighlighted = last;
        const el = cells.get(last);
        if (el) {
          el.classList.add('ring-4', 'ring-yellow-300');
          if (!prefersReduced) {
            el.animate(
              [{ transform: 'scale(1.0)' }, { transform: 'scale(1.06)' }, { transform: 'scale(1.0)' }],
              { duration: 220, easing: 'ease-out' }
            );
          }
        }
      } else {
        lastHighlighted = null;
      }
    }

    function callNext() {
      if (deck.length === 0) return;
      const n = deck.pop();
      called.push(n);
      setDisplay(n);
      updateUI();
    }

    function undo() {
      if (called.length === 0) return;
      const n = called.pop();
      deck.push(n);
      setDisplay(called.length ? called[called.length - 1] : null);
      updateUI();
    }

    function resetGame() {
      initGame();
    }

    // Fullscreen for projector use
    async function toggleFullscreen() {
      if (!document.fullscreenElement) {
        try { await document.documentElement.requestFullscreen(); } catch (e) {}
      } else {
        try { await document.exitFullscreen(); } catch (e) {}
      }
    }

    // Show/Hide board
    function toggleBoard() {
      const isHidden = boardSection.classList.contains('hidden');
      if (isHidden) {
        boardSection.classList.remove('hidden');
        toggleBoardBtn.textContent = 'Hide Board (B)';
      } else {
        boardSection.classList.add('hidden');
        toggleBoardBtn.textContent = 'Show Board (B)';
      }
      // Keep focus visible for keyboard users
      toggleBoardBtn.focus({ preventScroll: true });
    }

    // Events
    callBtn.addEventListener('click', callNext);
    undoBtn.addEventListener('click', undo);
    resetBtn.addEventListener('click', resetGame);
    fullscreenBtn.addEventListener('click', toggleFullscreen);
    toggleBoardBtn.addEventListener('click', toggleBoard);

    // Keyboard shortcuts
    window.addEventListener('keydown', (e) => {
      const tag = (e.target && e.target.tagName) || '';
      if (tag === 'INPUT' || tag === 'TEXTAREA') return;

      if (e.code === 'Space') { e.preventDefault(); callNext(); }
      else if (e.code === 'Backspace') { e.preventDefault(); undo(); }
      else if (e.key.toLowerCase() === 'r') { e.preventDefault(); resetGame(); }
      else if (e.key.toLowerCase() === 'f') { e.preventDefault(); toggleFullscreen(); }
      else if (e.key.toLowerCase() === 'b') { e.preventDefault(); toggleBoard(); }
    });

    // Footer year + boot
    document.getElementById('year').textContent = new Date().getFullYear();
    initGame();
  </script>
</body>
</html>
