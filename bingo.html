<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Classic Bingo Caller â€” ProjectorFirst</title>

  <!-- âœ… Memberstack -->
  <script data-memberstack-id="pk_650cfbc9692b47a2c045"
          src="https://api.memberstack.io/static/memberstack.js"
          async></script>

  <meta name="description" content="Classic Bingo Caller â€” simple, big-screen friendly bingo caller."/>
  <meta name="theme-color" content="#1e3a8a"/>
  <link rel="icon" href="/logo.svg" type="image/svg+xml"/>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: #ffffff;
      color: #000000;
      margin: 0;
      padding: 0;
    }

    main {
      margin-top: -40px;
    }

    .caller-box {
      position: relative;
      width: min(85vw, 1000px);
      height: min(40vw, 300px);
      border: 6px solid #1e3a8a;
      border-radius: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(10rem, 30vmin, 24rem);
      font-weight: 900;
      background: #000;
      color: #fff;
      overflow: hidden;
    }

    /* âœ… Recent calls area (balls) */
    .recent-calls {
      display: flex;
      flex-wrap: wrap;              /* allows wrapping into rows */
      justify-content: center;
      align-items: center;
      margin-top: 2rem;
      gap: 1rem;
      max-width: 90vw;
    }

    .recent-calls span {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 130px;
      height: 130px;
      border-radius: 50%;
      color: #fff;
      font-size: 3rem;
      font-weight: bold;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.4);
      flex-shrink: 0;               /* prevents shrinking */
    }

    .ball-B { background: #1e3a8a; }
    .ball-I { background: #dc2626; }
    .ball-N { background: #16a34a; }
    .ball-G { background: #f97316; }
    .ball-O { background: #9333ea; }

    .btn {
      font-size: 1.75rem;
      font-weight: bold;
      padding: 1.25rem 2.5rem;
      border-radius: 1rem;
      transition: background 0.2s;
      width: 100%;
      text-align: center;
    }

    .btn-next { background: #1e3a8a; color: white; }
    .btn-next:hover { background: #1d4ed8; }
    .btn-undo { background: #facc15; color: black; }
    .btn-reset { background: #dc2626; color: white; }
    .btn-fullscreen { background: #6d28d9; color: white; }

    @media (max-width: 768px) {
      .recent-calls span {
        width: 90px;
        height: 90px;
        font-size: 2rem;
      }
    }
  </style>
</head>

<body data-ms-content="bingo-game"
      class="flex flex-col items-center justify-start min-h-screen pt-0 mt-0">
  <main class="w-full max-w-6xl text-center">
    <div class="flex items-center justify-between mb-4 px-6">
      <a href="apps.html" class="btn btn-next w-auto px-6 py-2 text-lg">â¬… Back to Apps</a>
      <h1 class="text-5xl font-extrabold text-blue-900 mx-auto">ðŸŽ‰ Classic Bingo Caller</h1>
      <div class="w-40"></div>
    </div>

    <div class="mb-4 text-left px-6">
      <label for="theme" class="block text-lg font-semibold text-blue-900 mb-2">Theme</label>
      <select id="theme"
              class="w-full text-xl p-3 border-2 border-blue-900 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-400">
      </select>
    </div>

    <!-- Caller area -->
    <div class="flex flex-col items-center justify-center gap-6 mb-4">
      <div id="callerBox" class="caller-box">
        <span id="callerText">â€”</span>
        <span id="themeSymbol" style="position:absolute; bottom:10px; right:10px; font-size:3rem;"></span>
      </div>

      <!-- Called balls under the box -->
      <div id="recentCalls" class="recent-calls"></div>
    </div>

    <div class="flex flex-col md:flex-row items-start justify-center gap-3 mt-6">
      <div class="flex flex-col gap-3 w-56">
        <button onclick="callNext()" class="btn btn-next">Call Next (Space)</button>
        <button onclick="undoCall()" class="btn btn-undo">Undo (Backspace)</button>
        <button onclick="resetCaller()" class="btn btn-reset">Reset (R)</button>
        <button onclick="toggleFullscreen()" class="btn btn-fullscreen">Fullscreen (F)</button>
        <button onclick="toggleSound()" id="soundBtn" class="btn border-2 border-blue-900 text-blue-900 bg-white">ðŸ”Š Sound</button>
      </div>
    </div>
  </main>

  <script>
    function makeTheme(label, ranges = [[1,15],[16,30],[31,45],[46,60],[61,75]], rate = 1.0, symbol = "") {
      return {
        label,
        letters: ["B","I","N","G","O"],
        ranges,
        speakPrefix: (L, n) => `${L} ${n}`,
        speakRate: rate,
        ballClassFromLetter: L => `ball-${L}`,
        symbol
      };
    }

    const THEMES = {
      classic75: makeTheme("Classic 1â€“75 (B I N G O)"),
      uk90: makeTheme("UK 1â€“90", [[1,18],[19,36],[37,54],[55,72],[73,90]]),
      kids50: makeTheme("Kids 1â€“50", [[1,10],[11,20],[21,30],[31,40],[41,50]]),
      mini30: makeTheme("Mini 1â€“30", [[1,6],[7,12],[13,18],[19,24],[25,30]]),
      rapid75: makeTheme("Rapid 1â€“75 (faster speech)", [[1,15],[16,30],[31,45],[46,60],[61,75]], 1.4),
      halloween75: makeTheme("Halloween 1â€“75", undefined, 1.0, "ðŸŽƒ"),
      thanksgiving75: makeTheme("Thanksgiving 1â€“75", undefined, 1.0, "ðŸ¦ƒ"),
      christmas75: makeTheme("Christmas 1â€“75", undefined, 1.0, "ðŸŽ„"),
      easter75: makeTheme("Easter 1â€“75", undefined, 1.0, "ðŸ£"),
      memorial75: makeTheme("Memorial Day 1â€“75", undefined, 1.0, "â­"),
      flagday75: makeTheme("Flag Day 1â€“75", undefined, 1.0, "ðŸ‡ºðŸ‡¸"),
      independence75: makeTheme("Independence Day 1â€“75", undefined, 1.0, "ðŸŽ†"),
      laborday75: makeTheme("Labor Day 1â€“75", undefined, 1.0, "ðŸ› ï¸"),
      newyear75: makeTheme("New Yearâ€™s 1â€“75", undefined, 1.0, "ðŸŽ‰"),
      valentines75: makeTheme("Valentineâ€™s 1â€“75", undefined, 1.0, "ðŸ’˜"),
      stpatricks75: makeTheme("St. Patrickâ€™s 1â€“75", undefined, 1.0, "â˜˜ï¸")
    };

    let currentThemeKey = "classic75";
    let letters = [];
    let ranges = [];
    let allNumbers = [];
    let history = [];
    let soundOn = true;

    function initThemePicker() {
      const sel = document.getElementById("theme");
      sel.innerHTML = "";
      Object.entries(THEMES).forEach(([key, cfg]) => {
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = cfg.label;
        if (key === currentThemeKey) opt.selected = true;
        sel.appendChild(opt);
      });
      sel.addEventListener("change", (e) => {
        currentThemeKey = e.target.value;
        applyTheme();
      });
    }

    function applyTheme() {
      const cfg = THEMES[currentThemeKey];
      letters = cfg.letters;
      ranges = cfg.ranges;
      initGame();
      document.getElementById("themeSymbol").textContent = cfg.symbol || "";
    }

    function initGame() {
      allNumbers = [];
      history = [];
      for (let i = 0; i < letters.length; i++) {
        const [min, max] = ranges[i];
        for (let n = min; n <= max; n++) {
          allNumbers.push({letter: letters[i], number: n});
        }
      }
      shuffle(allNumbers);
      document.getElementById("callerText").textContent = "â€”";
      document.getElementById("recentCalls").innerHTML = "";
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function callNext() {
      if (allNumbers.length === 0) return;
      const call = allNumbers.pop();
      history.push(call);
      document.getElementById("callerText").textContent = call.letter + " " + call.number;
      updateRecent();
      if (soundOn) {
        const cfg = THEMES[currentThemeKey];
        const phrase = cfg.speakPrefix(call.letter, call.number);
        speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(phrase);
        utter.rate = cfg.speakRate || 1.0;
        speechSynthesis.speak(utter);
      }
    }

    function undoCall() {
      if (history.length === 0) return;
      const last = history.pop();
      allNumbers.push(last);
      document.getElementById("callerText").textContent = "â€”";
      updateRecent();
    }

    function resetCaller() { initGame(); }

    function updateRecent() {
      const cfg = THEMES[currentThemeKey];
      const recentDiv = document.getElementById("recentCalls");
      recentDiv.innerHTML = history
        .slice(-50) /* keep up to 50 recent calls visible */
        .reverse()
        .map(c => `<span class="${cfg.ballClassFromLetter(c.letter)}">${c.letter} ${c.number}</span>`)
        .join("");
    }

    function toggleSound() {
      soundOn = !soundOn;
      document.getElementById("soundBtn").textContent = soundOn ? "ðŸ”Š Sound" : "ðŸ”‡ Muted";
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        if (document.exitFullscreen) document.exitFullscreen();
      }
    }

    document.addEventListener("keydown", e => {
      if (e.code === "Space") { e.preventDefault(); callNext(); }
      if (e.code === "Backspace") { e.preventDefault(); undoCall(); }
      if (e.code === "KeyR") { resetCaller(); }
      if (e.code === "KeyF") { toggleFullscreen(); }
    });

    initThemePicker();
    applyTheme();
  </script>
</body>
</html>
