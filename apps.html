<script>
  document.addEventListener("DOMContentLoaded", async () => {
    // Wait for Memberstack to load completely
    const waitForMemberstack = () =>
      new Promise((resolve) => {
        const check = () => {
          if (window.$memberstackDom) resolve(window.$memberstackDom);
          else setTimeout(check, 100);
        };
        check();
      });

    const memberstack = await waitForMemberstack();

    try {
      const { data: member } = await memberstack.getCurrentMember();

      // If not logged in, redirect to index.html
      if (!member) {
        window.location.replace("index.html");
        return;
      }

      // Check if the member has an active paid plan OR a trial plan
      const hasActivePlan = Array.isArray(member.planConnections) &&
        member.planConnections.some(plan => 
          plan.status === "ACTIVE" || plan.planId === "pln_trial30-gpte0tfl"
        );

      // If not subscribed/on trial, send to paywall (or the checkout page)
      if (!hasActivePlan) {
        window.location.replace("checkout.html"); // Redirect to your checkout/paywall page
        return;
      }

      console.log("âœ… Access granted to:", member.auth.email);
    } catch (error) {
      console.error("Auth check failed:", error);
      window.location.replace("index.html"); // If script fails, go to homepage
    }
  });
</script>
